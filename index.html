<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Corkboard</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400;1,400&family=Inter:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        :root { --bg: #fdfaf6; --card: #ffffff; --accent: #2d2a26; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg); color: #444; -webkit-font-smoothing: antialiased; }
        h1, .post-content { font-family: 'Lora', serif; }
        
        .post-card { background: var(--card); border: 1px solid #f1ece4; box-shadow: 0 10px 40px -15px rgba(0,0,0,0.05); transition: transform 0.4s ease; }
        .post-card:hover { transform: translateY(-2px); }
        
        .login-input { background: #fff; border: 1px solid #e5e1da; transition: all 0.3s ease; }
        .login-input:focus { border-color: #2d2a26; outline: none; box-shadow: 0 0 0 4px rgba(0,0,0,0.02); }

        #auth-view, #board-view { display: none; }
        .fade-in { animation: fadeIn 1.2s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="min-h-screen">

    <!-- Login View -->
    <div id="auth-view" class="fixed inset-0 flex items-center justify-center p-6 bg-[#fdfaf6]">
        <div class="max-w-sm w-full text-center space-y-10 fade-in">
            <div>
                <h1 class="text-5xl italic mb-3 text-stone-800">Corkboard</h1>
                <p class="text-stone-400 text-xs tracking-[0.2em] uppercase">Private Space</p>
            </div>
            <div class="space-y-3">
                <input type="password" id="password" placeholder="Passcode" 
                    class="w-full p-4 rounded-2xl login-input text-center text-lg">
                <button onclick="handleLogin()" 
                    class="w-full bg-stone-800 text-white p-4 rounded-2xl font-medium hover:bg-stone-700 transition-all active:scale-95 shadow-lg">Enter</button>
            </div>
        </div>
    </div>

    <!-- Board View -->
    <div id="board-view" class="max-w-xl mx-auto py-24 px-6 fade-in">
        <header class="mb-24 flex justify-between items-center">
            <h1 class="text-3xl italic text-stone-800">Corkboard.</h1>
            <button onclick="handleLogout()" class="text-[10px] text-stone-300 hover:text-stone-800 uppercase tracking-widest transition-colors font-semibold">Sign Out</button>
        </header>

        <!-- New Post Form -->
        <div class="mb-24">
            <div class="bg-white rounded-[2rem] p-10 border border-stone-100 shadow-sm focus-within:shadow-xl transition-all duration-500">
                <textarea id="post-content" rows="3" placeholder="Click to write..." 
                    class="w-full resize-none border-none focus:ring-0 text-xl post-content placeholder-stone-200 leading-relaxed text-stone-800"></textarea>
                
                <div class="flex items-center justify-between mt-8 pt-6 border-t border-stone-50">
                    <label class="group cursor-pointer">
                        <input type="file" id="post-image" accept="image/*" class="hidden">
                        <span class="text-[11px] text-stone-400 group-hover:text-stone-600 transition-colors flex items-center gap-2 uppercase font-bold tracking-tighter">
                             <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5">
                                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 15.75l5.159-5.159a2.25 2.25 0 013.182 0l5.159 5.159m-1.5-1.5l1.409-1.409a2.25 2.25 0 013.182 0l2.909 2.909m-18 3.75h16.5a1.5 1.5 0 001.5-1.5V6.75a1.5 1.5 0 00-1.5-1.5H3.75A1.5 1.5 0 002.25 6.75v10.5a1.5 1.5 0 001.5 1.5zm10.5-11.25h.008v.008h-.008V8.25zm.375 0a.375.375 0 11-.75 0 .375.375 0 01.75 0z" />
                             </svg>
                             Upload Image
                        </span>
                    </label>
                    <button onclick="createPost()" id="post-btn" 
                        class="bg-stone-800 text-white px-10 py-3 rounded-full text-xs font-bold uppercase tracking-widest hover:bg-stone-900 transition-all">Post</button>
                </div>
            </div>
        </div>

        <!-- Posts Feed -->
        <div id="posts-container" class="space-y-20">
            <!-- Posts Injected Here -->
        </div>
    </div>

    <script>
        const SUPABASE_URL = 'https://bqiyfewuempqfymearrw.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJxaXlmZXd1ZW1wcWZ5bWVhcnJ3Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg0Mzg3MzksImV4cCI6MjA4NDAxNDczOX0.He0wDj2TIfOUb7pMCOO5FIIJC1zzmnuponKhh-1rtcM';
        
        const sb = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);

        function checkAuth() {
            if (localStorage.getItem('board_session') === 'active') {
                showView('board-view');
                loadPosts();
                subscribe();
            } else {
                showView('auth-view');
            }
        }

        function handleLogin() {
            if (document.getElementById('password').value === 'cork2026') {
                localStorage.setItem('board_session', 'active');
                checkAuth();
            } else {
                alert('Passcode incorrect.');
            }
        }

        function handleLogout() {
            localStorage.removeItem('board_session');
            location.reload();
        }

        function showView(viewId) {
            document.getElementById('auth-view').style.display = viewId === 'auth-view' ? 'flex' : 'none';
            document.getElementById('board-view').style.display = viewId === 'board-view' ? 'block' : 'none';
        }

        async function loadPosts() {
            const { data } = await sb.from('posts').select('*').order('created_at', { ascending: false });
            if (data) {
                document.getElementById('posts-container').innerHTML = data.map(post => renderPost(post)).join('');
            }
        }

        function renderPost(post) {
            const date = new Date(post.created_at).toLocaleDateString('en-US', { month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
            return `
                <div class="post-card rounded-[2.5rem] p-12 fade-in">
                    <p class="text-[10px] uppercase tracking-[0.4em] text-stone-300 mb-8 font-bold">${date}</p>
                    <div class="post-content text-2xl text-stone-800 leading-[1.7] whitespace-pre-wrap">${post.content}</div>
                    ${post.image_url ? `<img src="${post.image_url}" class="mt-12 rounded-[2rem] w-full h-auto">` : ''}
                </div>
            `;
        }

        async function createPost() {
            const content = document.getElementById('post-content');
            const fileInput = document.getElementById('post-image');
            const btn = document.getElementById('post-btn');
            
            if (!content.value.trim() && !fileInput.files[0]) return;
            
            btn.disabled = true;
            btn.innerText = "...";

            let image_url = null;
            if (fileInput.files[0]) {
                const file = fileInput.files[0];
                const path = `${Date.now()}-${file.name}`;
                const { data } = await sb.storage.from('post-images').upload(path, file);
                if (data) {
                    image_url = sb.storage.from('post-images').getPublicUrl(path).data.publicUrl;
                }
            }

            const { error } = await sb.from('posts').insert([{ content: content.value, image_url }]);

            if (error) alert("Error: Check console");
            else {
                content.value = '';
                fileInput.value = '';
                loadPosts();
            }
            btn.disabled = false;
            btn.innerText = "Post";
        }

        function subscribe() {
            sb.channel('realtime-posts')
            .on('postgres_changes', { event: 'INSERT', table: 'posts' }, loadPosts)
            .subscribe();
        }

        checkAuth();
    </script>
</body>
</html>
